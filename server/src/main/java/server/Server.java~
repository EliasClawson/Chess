package server;

import com.sun.net.httpserver.HttpServer;
import service.UserService;
import service.GameService;
import dataaccess.UserDAO;
import dataaccess.GameDAO;
import dataaccess.AuthDAO;
import java.net.InetSocketAddress;
import java.io.IOException;

public class Server {
    private HttpServer server;

    public void run(int port) {
        try {
            // Create an HTTP server instance
            server = HttpServer.create(new InetSocketAddress(port), 0);

            // Initialize DAOs
            UserDAO userDAO = new UserDAO();
            GameDAO gameDAO = new GameDAO();
            AuthDAO authDAO = new AuthDAO();

            // Initialize Services
            UserService userService = new UserService(userDAO, authDAO);
            GameService gameService = new GameService(gameDAO, authDAO);

            // Register context paths
            server.createContext("/user", new UserHandler(userService));
            server.createContext("/session", new UserHandler(userService)); // Login/logout
            server.createContext("/game", new GameHandler(gameService));
            server.createContext("/game/join", new GameHandler(gameService));

            // Start the server
            server.setExecutor(null);
            server.start();

            System.out.println("â™• 240 Chess Server started on port " + port);
        } catch (IOException e) {
            System.err.println("Error starting server: " + e.getMessage());
        }
    }
}
